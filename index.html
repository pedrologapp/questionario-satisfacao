<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Questionário de Satisfação - Centro Educacional Amadeus</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header h2 {
            font-size: 1.3rem;
            margin-bottom: 5px;
            font-weight: 400;
        }

        .header p {
            font-size: 1rem;
            opacity: 0.9;
        }

        .progress-container {
            background: #f8f9fa;
            padding: 20px 30px;
            border-bottom: 1px solid #e9ecef;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: center;
            margin-top: 10px;
            font-weight: 600;
            color: #495057;
        }

        .form-container {
            padding: 40px 30px;
        }

        .section {
            margin-bottom: 40px;
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-title {
            font-size: 1.5rem;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #4facfe;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
            font-size: 0.95rem;
        }

        .required {
            color: #dc3545;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #fff;
        }

        .form-input:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        .form-input.valid {
            border-color: #28a745;
        }

        .form-input.invalid {
            border-color: #dc3545;
        }

        .form-select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .form-select:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        .error-message {
            color: #dc3545;
            font-size: 0.85rem;
            margin-top: 5px;
            display: none;
        }

        .success-message {
            color: #28a745;
            font-size: 0.85rem;
            margin-top: 5px;
            display: none;
        }

        .question-group {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            border-left: 4px solid #4facfe;
        }

        .question-title {
            font-weight: 600;
            margin-bottom: 15px;
            color: #2c3e50;
            font-size: 1rem;
        }

        .radio-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 6px;
            transition: background-color 0.2s ease;
        }

        .radio-option:hover {
            background: rgba(79, 172, 254, 0.1);
        }

        .radio-option input[type="radio"] {
            margin: 0;
            cursor: pointer;
        }

        .radio-option label {
            cursor: pointer;
            font-size: 0.9rem;
            color: #495057;
        }

        .scale-legend {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.8rem;
            color: #6c757d;
            font-style: italic;
        }

        .textarea {
            width: 100%;
            min-height: 100px;
            padding: 12px 16px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
            resize: vertical;
            transition: all 0.3s ease;
        }

        .textarea:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            gap: 20px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(79, 172, 254, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4facfe;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .success-screen {
            display: none;
            text-align: center;
            padding: 60px 30px;
        }

        .success-icon {
            width: 80px;
            height: 80px;
            background: #28a745;
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
        }

        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
            color: #4facfe;
            margin-left: 5px;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.8rem;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .header {
                padding: 30px 20px;
            }

            .header h1 {
                font-size: 1.8rem;
            }

            .header h2 {
                font-size: 1.1rem;
            }

            .form-container {
                padding: 30px 20px;
            }

            .progress-container {
                padding: 15px 20px;
            }

            .radio-group {
                flex-direction: column;
                gap: 10px;
            }

            .navigation-buttons {
                flex-direction: column;
                gap: 15px;
            }

            .btn {
                width: 100%;
            }
        }

        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid transparent;
            border-radius: 8px;
            display: none;
        }

        .alert-danger {
            color: #721c24;
            background-color: #f8d7da;
            border-color: #f5c6cb;
        }

        .alert-success {
            color: #155724;
            background-color: #d4edda;
            border-color: #c3e6cb;
        }

        .session-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 0.9rem;
            color: #1565c0;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>CENTRO EDUCACIONAL AMADEUS</h1>
            <h2>Questionário de Satisfação - 1º Semestre 2025</h2>
            <p>Educação Infantil</p>
        </div>

        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text" id="progressText">0% concluído</div>
        </div>

        <!-- Form Container -->
        <div class="form-container">
            <!-- Session Recovery Alert -->
            <div class="session-info" id="sessionInfo">
                <strong>Sessão recuperada!</strong> Seus dados foram restaurados automaticamente.
            </div>

            <!-- Alerts -->
            <div class="alert alert-danger" id="alertError"></div>
            <div class="alert alert-success" id="alertSuccess"></div>

            <form id="questionarioForm">
                <!-- Seção 1: Dados de Identificação -->
                <div class="section active" id="section1">
                    <h3 class="section-title">Dados de Identificação</h3>
                    
                    <div class="form-group">
                        <label class="form-label" for="nomeResponsavel">
                            Nome completo do responsável <span class="required">*</span>
                        </label>
                        <input type="text" id="nomeResponsavel" name="nomeResponsavel" class="form-input" required>
                        <div class="error-message" id="errorNomeResponsavel">Este campo é obrigatório</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="cpfResponsavel">
                            CPF do responsável <span class="required">*</span>
                            <span class="tooltip">ℹ️
                                <span class="tooltiptext">Cada CPF pode responder apenas uma vez</span>
                            </span>
                        </label>
                        <input type="text" id="cpfResponsavel" name="cpfResponsavel" class="form-input" 
                               placeholder="000.000.000-00" maxlength="14" required>
                        <div class="error-message" id="errorCpfResponsavel">Por favor, insira um CPF válido</div>
                        <div class="success-message" id="successCpfResponsavel">CPF válido</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="telefoneResponsavel">
                            Telefone <span class="required">*</span>
                        </label>
                        <input type="text" id="telefoneResponsavel" name="telefoneResponsavel" class="form-input" 
                               placeholder="(00) 00000-0000" maxlength="15" required>
                        <div class="error-message" id="errorTelefoneResponsavel">Este campo é obrigatório</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="nomeFilho">
                            Nome completo do(a) filho(a) <span class="required">*</span>
                        </label>
                        <input type="text" id="nomeFilho" name="nomeFilho" class="form-input" required>
                        <div class="error-message" id="errorNomeFilho">Este campo é obrigatório</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="turma">
                            Turma <span class="required">*</span>
                        </label>
                        <select id="turma" name="turma" class="form-select" required>
                            <option value="">Selecione a turma</option>
                            <option value="Maternalzinho II">Maternalzinho II</option>
                            <option value="Maternal III">Maternal III</option>
                            <option value="Grupo 4">Grupo 4</option>
                            <option value="Grupo 5">Grupo 5</option>
                        </select>
                        <div class="error-message" id="errorTurma">Este campo é obrigatório</div>
                    </div>
                </div>

                <!-- Seção 2: Aspectos Pedagógicos e Equipe -->
                <div class="section" id="section2">
                    <h3 class="section-title">Aspectos Pedagógicos e Equipe</h3>
                    <p style="margin-bottom: 20px; color: #6c757d; font-style: italic;">
                        Avalie cada item de acordo com sua satisfação (1 = Muito insatisfeito, 4 = Muito satisfeito)
                    </p>

                    <div class="question-group">
                        <div class="question-title">Professores titulares</div>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="prof_titulares_1" name="professores_titulares" value="1" required>
                                <label for="prof_titulares_1">1</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="prof_titulares_2" name="professores_titulares" value="2">
                                <label for="prof_titulares_2">2</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="prof_titulares_3" name="professores_titulares" value="3">
                                <label for="prof_titulares_3">3</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="prof_titulares_4" name="professores_titulares" value="4">
                                <label for="prof_titulares_4">4</label>
                            </div>
                        </div>
                        <div class="scale-legend">
                            <span>Muito insatisfeito</span>
                            <span>Muito satisfeito</span>
                        </div>
                    </div>

                    <div class="question-group">
                        <div class="question-title">Professores auxiliares</div>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="prof_auxiliares_1" name="professores_auxiliares" value="1" required>
                                <label for="prof_auxiliares_1">1</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="prof_auxiliares_2" name="professores_auxiliares" value="2">
                                <label for="prof_auxiliares_2">2</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="prof_auxiliares_3" name="professores_auxiliares" value="3">
                                <label for="prof_auxiliares_3">3</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="prof_auxiliares_4" name="professores_auxiliares" value="4">
                                <label for="prof_auxiliares_4">4</label>
                            </div>
                        </div>
                        <div class="scale-legend">
                            <span>Muito insatisfeito</span>
                            <span>Muito satisfeito</span>
                        </div>
                    </div>

                    <div class="question-group">
                        <div class="question-title">Ensino bilíngue</div>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="ensino_bilingue_1" name="ensino_bilingue" value="1" required>
                                <label for="ensino_bilingue_1">1</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="ensino_bilingue_2" name="ensino_bilingue" value="2">
                                <label for="ensino_bilingue_2">2</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="ensino_bilingue_3" name="ensino_bilingue" value="3">
                                <label for="ensino_bilingue_3">3</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="ensino_bilingue_4" name="ensino_bilingue" value="4">
                                <label for="ensino_bilingue_4">4</label>
                            </div>
                        </div>
                        <div class="scale-legend">
                            <span>Muito insatisfeito</span>
                            <span>Muito satisfeito</span>
                        </div>
                    </div>

                    <div class="question-group">
                        <div class="question-title">Teacher Thalyta</div>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="teacher_thalyta_1" name="teacher_thalyta" value="1" required>
                                <label for="teacher_thalyta_1">1</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="teacher_thalyta_2" name="teacher_thalyta" value="2">
                                <label for="teacher_thalyta_2">2</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="teacher_thalyta_3" name="teacher_thalyta" value="3">
                                <label for="teacher_thalyta_3">3</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="teacher_thalyta_4" name="teacher_thalyta" value="4">
                                <label for="teacher_thalyta_4">4</label>
                            </div>
                        </div>
                        <div class="scale-legend">
                            <span>Muito insatisfeito</span>
                            <span>Muito satisfeito</span>
                        </div>
                    </div>

                    <div class="question-group">
                        <div class="question-title">Socioemocional (Psicóloga Polyana)</div>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="socioemocional_1" name="socioemocional" value="1" required>
                                <label for="socioemocional_1">1</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="socioemocional_2" name="socioemocional" value="2">
                                <label for="socioemocional_2">2</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="socioemocional_3" name="socioemocional" value="3">
                                <label for="socioemocional_3">3</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="socioemocional_4" name="socioemocional" value="4">
                                <label for="socioemocional_4">4</label>
                            </div>
                        </div>
                        <div class="scale-legend">
                            <span>Muito insatisfeito</span>
                            <span>Muito satisfeito</span>
                        </div>
                    </div>

                    <div class="question-group">
                        <div class="question-title">Desenvolvimento e progresso do seu(a) filho(a)</div>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="desenvolvimento_1" name="desenvolvimento" value="1" required>
                                <label for="desenvolvimento_1">1</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="desenvolvimento_2" name="desenvolvimento" value="2">
                                <label for="desenvolvimento_2">2</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="desenvolvimento_3" name="desenvolvimento" value="3">
                                <label for="desenvolvimento_3">3</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="desenvolvimento_4" name="desenvolvimento" value="4">
                                <label for="desenvolvimento_4">4</label>
                            </div>
                        </div>
                        <div class="scale-legend">
                            <span>Muito insatisfeito</span>
                            <span>Muito satisfeito</span>
                        </div>
                    </div>

                    <div class="question-group">
                        <div class="question-title">Atividades lúdicas e recreativas</div>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="atividades_ludicas_1" name="atividades_ludicas" value="1" required>
                                <label for="atividades_ludicas_1">1</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="atividades_ludicas_2" name="atividades_ludicas" value="2">
                                <label for="atividades_ludicas_2">2</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="atividades_ludicas_3" name="atividades_ludicas" value="3">
                                <label for="atividades_ludicas_3">3</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="atividades_ludicas_4" name="atividades_ludicas" value="4">
                                <label for="atividades_ludicas_4">4</label>
                            </div>
                        </div>
                        <div class="scale-legend">
                            <span>Muito insatisfeito</span>
                            <span>Muito satisfeito</span>
                        </div>
                    </div>

                    <div class="question-group">
                        <div class="question-title">Processo de adaptação e acolhimento</div>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="adaptacao_1" name="adaptacao" value="1" required>
                                <label for="adaptacao_1">1</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="adaptacao_2" name="adaptacao" value="2">
                                <label for="adaptacao_2">2</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="adaptacao_3" name="adaptacao" value="3">
                                <label for="adaptacao_3">3</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="adaptacao_4" name="adaptacao" value="4">
                                <label for="adaptacao_4">4</label>
                            </div>
                        </div>
                        <div class="scale-legend">
                            <span>Muito insatisfeito</span>
                            <span>Muito satisfeito</span>
                        </div>
                    </div>

                    <div class="question-group">
                        <div class="question-title">Esportes</div>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="esportes_1" name="esportes" value="1" required>
                                <label for="esportes_1">1</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="esportes_2" name="esportes" value="2">
                                <label for="esportes_2">2</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="esportes_3" name="esportes" value="3">
                                <label for="esportes_3">3</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="esportes_4" name="esportes" value="4">
                                <label for="esportes_4">4</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="esportes_na" name="esportes" value="nao_participa">
                                <label for="esportes_na">Não participa</label>
                            </div>
                        </div>
                        <div class="scale-legend">
                            <span>Muito insatisfeito</span>
                            <span>Muito satisfeito</span>
                        </div>
                    </div>
                </div>

                <!-- Seção 3: Estrutura e Serviços -->
                <div class="section" id="section3">
                    <h3 class="section-title">Estrutura e Serviços</h3>
                    <p style="margin-bottom: 20px; color: #6c757d; font-style: italic;">
                        Avalie cada item de acordo com sua satisfação (1 = Muito insatisfeito, 4 = Muito satisfeito)
                    </p>

                    <div class="question-group">
                        <div class="question-title">Limpeza e conservação dos espaços</div>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="limpeza_1" name="limpeza" value="1" required>
                                <label for="limpeza_1">1</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="limpeza_2" name="limpeza" value="2">
                                <label for="limpeza_2">2</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="limpeza_3" name="limpeza" value="3">
                                <label for="limpeza_3">3</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="limpeza_4" name="limpeza" value="4">
                                <label for="limpeza_4">4</label>
                            </div>
                        </div>
                        <div class="scale-legend">
                            <span>Muito insatisfeito</span>
                            <span>Muito satisfeito</span>
                        </div>
                    </div>

                    <div class="question-group">
                        <div class="question-title">Segurança da escola</div>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="seguranca_1" name="seguranca" value="1" required>
                                <label for="seguranca_1">1</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="seguranca_2" name="seguranca" value="2">
                                <label for="seguranca_2">2</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="seguranca_3" name="seguranca" value="3">
                                <label for="seguranca_3">3</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="seguranca_4" name="seguranca" value="4">
                                <label for="seguranca_4">4</label>
                            </div>
                        </div>
                        <div class="scale-legend">
                            <span>Muito insatisfeito</span>
                            <span>Muito satisfeito</span>
                        </div>
                    </div>

                    <div class="question-group">
                        <div class="question-title">Salas de aula</div>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="salas_aula_1" name="salas_aula" value="1" required>
                                <label for="salas_aula_1">1</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="salas_aula_2" name="salas_aula" value="2">
                                <label for="salas_aula_2">2</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="salas_aula_3" name="salas_aula" value="3">
                                <label for="salas_aula_3">3</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="salas_aula_4" name="salas_aula" value="4">
                                <label for="salas_aula_4">4</label>
                            </div>
                        </div>
                        <div class="scale-legend">
                            <span>Muito insatisfeito</span>
                            <span>Muito satisfeito</span>
                        </div>
                    </div>

                    <div class="question-group">
                        <div class="question-title">Playground e áreas de recreação</div>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="playground_1" name="playground" value="1" required>
                                <label for="playground_1">1</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="playground_2" name="playground" value="2">
                                <label for="playground_2">2</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="playground_3" name="playground" value="3">
                                <label for="playground_3">3</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="playground_4" name="playground" value="4">
                                <label for="playground_4">4</label>
                            </div>
                        </div>
                        <div class="scale-legend">
                            <span>Muito insatisfeito</span>
                            <span>Muito satisfeito</span>
                        </div>
                    </div>

                    <div class="question-group">
                        <div class="question-title">Banheiros</div>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="banheiros_1" name="banheiros" value="1" required>
                                <label for="banheiros_1">1</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="banheiros_2" name="banheiros" value="2">
                                <label for="banheiros_2">2</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="banheiros_3" name="banheiros" value="3">
                                <label for="banheiros_3">3</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="banheiros_4" name="banheiros" value="4">
                                <label for="banheiros_4">4</label>
                            </div>
                        </div>
                        <div class="scale-legend">
                            <span>Muito insatisfeito</span>
                            <span>Muito satisfeito</span>
                        </div>
                    </div>

                    <div class="question-group">
                        <div class="question-title">Biblioteca/espaço de leitura</div>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="biblioteca_1" name="biblioteca" value="1" required>
                                <label for="biblioteca_1">1</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="biblioteca_2" name="biblioteca" value="2">
                                <label for="biblioteca_2">2</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="biblioteca_3" name="biblioteca" value="3">
                                <label for="biblioteca_3">3</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="biblioteca_4" name="biblioteca" value="4">
                                <label for="biblioteca_4">4</label>
                            </div>
                        </div>
                        <div class="scale-legend">
                            <span>Muito insatisfeito</span>
                            <span>Muito satisfeito</span>
                        </div>
                    </div>

                    <div class="question-group">
                        <div class="question-title">Cantina</div>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="cantina_1" name="cantina" value="1" required>
                                <label for="cantina_1">1</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="cantina_2" name="cantina" value="2">
                                <label for="cantina_2">2</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="cantina_3" name="cantina" value="3">
                                <label for="cantina_3">3</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="cantina_4" name="cantina" value="4">
                                <label for="cantina_4">4</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="cantina_na" name="cantina" value="nao_utiliza">
                                <label for="cantina_na">Não utiliza</label>
                            </div>
                        </div>
                        <div class="scale-legend">
                            <span>Muito insatisfeito</span>
                            <span>Muito satisfeito</span>
                        </div>
                    </div>
                </div>

                <!-- Seção 4: Comunicação e Gestão -->
                <div class="section" id="section4">
                    <h3 class="section-title">Comunicação e Gestão</h3>
                    <p style="margin-bottom: 20px; color: #6c757d; font-style: italic;">
                        Avalie cada item de acordo com sua satisfação (1 = Muito insatisfeito, 4 = Muito satisfeito)
                    </p>

                    <div class="question-group">
                        <div class="question-title">Coordenação pedagógica</div>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="coordenacao_1" name="coordenacao" value="1" required>
                                <label for="coordenacao_1">1</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="coordenacao_2" name="coordenacao" value="2">
                                <label for="coordenacao_2">2</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="coordenacao_3" name="coordenacao" value="3">
                                <label for="coordenacao_3">3</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="coordenacao_4" name="coordenacao" value="4">
                                <label for="coordenacao_4">4</label>
                            </div>
                        </div>
                        <div class="scale-legend">
                            <span>Muito insatisfeito</span>
                            <span>Muito satisfeito</span>
                        </div>
                    </div>

                    <div class="question-group">
                        <div class="question-title">Comunicação escola-família</div>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="comunicacao_1" name="comunicacao" value="1" required>
                                <label for="comunicacao_1">1</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="comunicacao_2" name="comunicacao" value="2">
                                <label for="comunicacao_2">2</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="comunicacao_3" name="comunicacao" value="3">
                                <label for="comunicacao_3">3</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="comunicacao_4" name="comunicacao" value="4">
                                <label for="comunicacao_4">4</label>
                            </div>
                        </div>
                        <div class="scale-legend">
                            <span>Muito insatisfeito</span>
                            <span>Muito satisfeito</span>
                        </div>
                    </div>

                    <div class="question-group">
                        <div class="question-title">Frequência e qualidade dos feedbacks</div>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="feedbacks_1" name="feedbacks" value="1" required>
                                <label for="feedbacks_1">1</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="feedbacks_2" name="feedbacks" value="2">
                                <label for="feedbacks_2">2</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="feedbacks_3" name="feedbacks" value="3">
                                <label for="feedbacks_3">3</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="feedbacks_4" name="feedbacks" value="4">
                                <label for="feedbacks_4">4</label>
                            </div>
                        </div>
                        <div class="scale-legend">
                            <span>Muito insatisfeito</span>
                            <span>Muito satisfeito</span>
                        </div>
                    </div>

                    <div class="question-group">
                        <div class="question-title">Atendimento na recepção</div>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="recepcao_1" name="recepcao" value="1" required>
                                <label for="recepcao_1">1</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="recepcao_2" name="recepcao" value="2">
                                <label for="recepcao_2">2</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="recepcao_3" name="recepcao" value="3">
                                <label for="recepcao_3">3</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="recepcao_4" name="recepcao" value="4">
                                <label for="recepcao_4">4</label>
                            </div>
                        </div>
                        <div class="scale-legend">
                            <span>Muito insatisfeito</span>
                            <span>Muito satisfeito</span>
                        </div>
                    </div>

                    <div class="question-group">
                        <div class="question-title">Flexibilidade de horários</div>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="flexibilidade_1" name="flexibilidade" value="1" required>
                                <label for="flexibilidade_1">1</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="flexibilidade_2" name="flexibilidade" value="2">
                                <label for="flexibilidade_2">2</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="flexibilidade_3" name="flexibilidade" value="3">
                                <label for="flexibilidade_3">3</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="flexibilidade_4" name="flexibilidade" value="4">
                                <label for="flexibilidade_4">4</label>
                            </div>
                        </div>
                        <div class="scale-legend">
                            <span>Muito insatisfeito</span>
                            <span>Muito satisfeito</span>
                        </div>
                    </div>

                    <div class="question-group">
                        <div class="question-title">Organização de eventos pedagógicos</div>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="eventos_pedagogicos_1" name="eventos_pedagogicos" value="1" required>
                                <label for="eventos_pedagogicos_1">1</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="eventos_pedagogicos_2" name="eventos_pedagogicos" value="2">
                                <label for="eventos_pedagogicos_2">2</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="eventos_pedagogicos_3" name="eventos_pedagogicos" value="3">
                                <label for="eventos_pedagogicos_3">3</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="eventos_pedagogicos_4" name="eventos_pedagogicos" value="4">
                                <label for="eventos_pedagogicos_4">4</label>
                            </div>
                        </div>
                        <div class="scale-legend">
                            <span>Muito insatisfeito</span>
                            <span>Muito satisfeito</span>
                        </div>
                    </div>

                    <div class="question-group">
                        <div class="question-title">Organização de eventos recreativos</div>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="eventos_recreativos_1" name="eventos_recreativos" value="1" required>
                                <label for="eventos_recreativos_1">1</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="eventos_recreativos_2" name="eventos_recreativos" value="2">
                                <label for="eventos_recreativos_2">2</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="eventos_recreativos_3" name="eventos_recreativos" value="3">
                                <label for="eventos_recreativos_3">3</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="eventos_recreativos_4" name="eventos_recreativos" value="4">
                                <label for="eventos_recreativos_4">4</label>
                            </div>
                        </div>
                        <div class="scale-legend">
                            <span>Muito insatisfeito</span>
                            <span>Muito satisfeito</span>
                        </div>
                    </div>
                </div>

                <!-- Seção 5: Satisfação Geral -->
                <div class="section" id="section5">
                    <h3 class="section-title">Satisfação Geral</h3>

                    <div class="question-group">
                        <div class="question-title">Você recomendaria a escola para outros pais?</div>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="recomendaria_1" name="recomendaria" value="certamente_nao" required>
                                <label for="recomendaria_1">Certamente não</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="recomendaria_2" name="recomendaria" value="provavelmente_nao">
                                <label for="recomendaria_2">Provavelmente não</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="recomendaria_3" name="recomendaria" value="provavelmente_sim">
                                <label for="recomendaria_3">Provavelmente sim</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="recomendaria_4" name="recomendaria" value="certamente_sim">
                                <label for="recomendaria_4">Certamente sim</label>
                            </div>
                        </div>
                    </div>

                    <div class="question-group">
                        <div class="question-title">Satisfação geral com a escola</div>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="satisfacao_geral_1" name="satisfacao_geral" value="1" required>
                                <label for="satisfacao_geral_1">1</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="satisfacao_geral_2" name="satisfacao_geral" value="2">
                                <label for="satisfacao_geral_2">2</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="satisfacao_geral_3" name="satisfacao_geral" value="3">
                                <label for="satisfacao_geral_3">3</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="satisfacao_geral_4" name="satisfacao_geral" value="4">
                                <label for="satisfacao_geral_4">4</label>
                            </div>
                        </div>
                        <div class="scale-legend">
                            <span>Muito insatisfeito</span>
                            <span>Muito satisfeito</span>
                        </div>
                    </div>

                    <div class="question-group">
                        <div class="question-title">Sua criança demonstra satisfação em frequentar a escola?</div>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="crianca_satisfacao_1" name="crianca_satisfacao" value="nunca" required>
                                <label for="crianca_satisfacao_1">Nunca</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="crianca_satisfacao_2" name="crianca_satisfacao" value="raramente">
                                <label for="crianca_satisfacao_2">Raramente</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="crianca_satisfacao_3" name="crianca_satisfacao" value="frequentemente">
                                <label for="crianca_satisfacao_3">Frequentemente</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="crianca_satisfacao_4" name="crianca_satisfacao" value="sempre">
                                <label for="crianca_satisfacao_4">Sempre</label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Seção 6: Comentários -->
                <div class="section" id="section6">
                    <h3 class="section-title">Comentários</h3>

                    <div class="form-group">
                        <label class="form-label" for="pontoForte">
                            Qual considera ser o maior ponto forte da escola?
                        </label>
                        <textarea id="pontoForte" name="pontoForte" class="textarea" 
                                  placeholder="Compartilhe sua opinião sobre os pontos fortes da escola..."></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="melhorias">
                            O que precisa ser melhorado com urgência?
                        </label>
                        <textarea id="melhorias" name="melhorias" class="textarea" 
                                  placeholder="Descreva aspectos que considera prioritários para melhoria..."></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="observacoes">
                            Sugestões, elogios ou observações adicionais
                        </label>
                        <textarea id="observacoes" name="observacoes" class="textarea" 
                                  placeholder="Compartilhe qualquer comentário adicional que considere relevante..."></textarea>
                    </div>
                </div>

                <!-- Navigation Buttons -->
                <div class="navigation-buttons">
                    <button type="button" class="btn btn-secondary" id="btnPrevious" onclick="previousSection()" style="display: none;">
                        ← Anterior
                    </button>
                    <button type="button" class="btn btn-primary" id="btnNext" onclick="nextSection()">
                        Próximo →
                    </button>
                    <button type="submit" class="btn btn-primary" id="btnSubmit" style="display: none;">
                        Enviar Questionário
                    </button>
                </div>
            </form>

            <!-- Loading Screen -->
            <div class="loading" id="loadingScreen">
                <div class="spinner"></div>
                <p>Enviando questionário...</p>
            </div>

            <!-- Success Screen -->
            <div class="success-screen" id="successScreen">
                <div class="success-icon">✓</div>
                <h2>Questionário enviado com sucesso!</h2>
                <p>Obrigado pela sua participação. Suas respostas são muito importantes para nós.</p>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentSection = 1;
        const totalSections = 6;
        let startTime = Date.now();
        let sectionStartTimes = {};
        let clickCount = 0;
        let scrollDepth = 0;
        let errors = [];
        let submittedCPFs = []; // Simulated database of submitted CPFs
        let sessionId = generateUUID();

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeForm();
            setupEventListeners();
            loadSessionData();
            trackPageLoad();
        });

        function initializeForm() {
            updateProgress();
            sectionStartTimes[currentSection] = Date.now();
            
            // Setup masks
            setupMasks();
            
            // Setup real-time validation
            setupValidation();
            
            // Prevent form submission on Enter
            document.getElementById('questionarioForm').addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && e.target.type !== 'submit') {
                    e.preventDefault();
                }
            });

            // Prevent page unload without warning
            window.addEventListener('beforeunload', function(e) {
                if (hasUnsavedData()) {
                    e.preventDefault();
                    e.returnValue = '';
                }
            });
        }

        function setupEventListeners() {
            // Track clicks
            document.addEventListener('click', function() {
                clickCount++;
            });

            // Track scroll depth
            window.addEventListener('scroll', function() {
                const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                const docHeight = document.documentElement.scrollHeight - window.innerHeight;
                const scrollPercent = Math.round((scrollTop / docHeight) * 100);
                scrollDepth = Math.max(scrollDepth, scrollPercent);
            });

            // Auto-save on input changes
            const inputs = document.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                input.addEventListener('change', saveSessionData);
                input.addEventListener('input', saveSessionData);
            });

            // Form submission
            document.getElementById('questionarioForm').addEventListener('submit', handleSubmit);
        }

        function setupMasks() {
            // CPF mask
            const cpfInput = document.getElementById('cpfResponsavel');
            cpfInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
                e.target.value = value;
                
                // Validate CPF in real-time
                validateCPF(value);
            });

            // Phone mask
            const phoneInput = document.getElementById('telefoneResponsavel');
            phoneInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                value = value.replace(/(\d{2})(\d)/, '($1) $2');
                value = value.replace(/(\d{5})(\d)/, '$1-$2');
                e.target.value = value;
            });
        }

        function setupValidation() {
            const requiredFields = document.querySelectorAll('[required]');
            requiredFields.forEach(field => {
                field.addEventListener('blur', function() {
                    validateField(field);
                });
                
                field.addEventListener('input', function() {
                    if (field.classList.contains('invalid')) {
                        validateField(field);
                    }
                });
            });
        }

        function validateField(field) {
            const value = field.value.trim();
            const fieldName = field.name;
            let isValid = true;
            let errorMessage = '';

            if (field.hasAttribute('required') && !value) {
                isValid = false;
                errorMessage = 'Este campo é obrigatório';
            } else if (fieldName === 'cpfResponsavel' && value) {
                const cpfValidation = validateCPFFormat(value);
                if (!cpfValidation.isValid) {
                    isValid = false;
                    errorMessage = cpfValidation.message;
                }
            }

            updateFieldValidation(field, isValid, errorMessage);
            return isValid;
        }

        function validateCPF(cpf) {
            const cleanCPF = cpf.replace(/\D/g, '');
            
            if (cleanCPF.length === 11) {
                const validation = validateCPFFormat(cpf);
                const field = document.getElementById('cpfResponsavel');
                
                if (validation.isValid) {
                    // Check for duplicates
                    if (submittedCPFs.includes(cleanCPF)) {
                        updateFieldValidation(field, false, 'Este CPF já respondeu ao questionário. Cada responsável pode responder apenas uma vez.');
                        return false;
                    } else {
                        updateFieldValidation(field, true, '');
                        showSuccessMessage('successCpfResponsavel', 'CPF válido');
                        return true;
                    }
                } else {
                    updateFieldValidation(field, false, validation.message);
                    return false;
                }
            }
            return false;
        }

        function validateCPFFormat(cpf) {
            const cleanCPF = cpf.replace(/\D/g, '');
            
            if (cleanCPF.length !== 11) {
                return { isValid: false, message: 'CPF deve ter 11 dígitos' };
            }
            
            // Check for known invalid patterns
            if (/^(\d)\1{10}$/.test(cleanCPF)) {
                return { isValid: false, message: 'Por favor, insira um CPF válido' };
            }
            
            // Validate CPF algorithm
            let sum = 0;
            for (let i = 0; i < 9; i++) {
                sum += parseInt(cleanCPF.charAt(i)) * (10 - i);
            }
            let remainder = (sum * 10) % 11;
            if (remainder === 10 || remainder === 11) remainder = 0;
            if (remainder !== parseInt(cleanCPF.charAt(9))) {
                return { isValid: false, message: 'Por favor, insira um CPF válido' };
            }
            
            sum = 0;
            for (let i = 0; i < 10; i++) {
                sum += parseInt(cleanCPF.charAt(i)) * (11 - i);
            }
            remainder = (sum * 10) % 11;
            if (remainder === 10 || remainder === 11) remainder = 0;
            if (remainder !== parseInt(cleanCPF.charAt(10))) {
                return { isValid: false, message: 'Por favor, insira um CPF válido' };
            }
            
            return { isValid: true, message: '' };
        }

        function updateFieldValidation(field, isValid, errorMessage) {
            const errorElement = document.getElementById('error' + field.name.charAt(0).toUpperCase() + field.name.slice(1));
            const successElement = document.getElementById('success' + field.name.charAt(0).toUpperCase() + field.name.slice(1));
            
            if (isValid) {
                field.classList.remove('invalid');
                field.classList.add('valid');
                if (errorElement) {
                    errorElement.style.display = 'none';
                }
            } else {
                field.classList.remove('valid');
                field.classList.add('invalid');
                if (errorElement) {
                    errorElement.textContent = errorMessage;
                    errorElement.style.display = 'block';
                }
                if (successElement) {
                    successElement.style.display = 'none';
                }
            }
        }

        function showSuccessMessage(elementId, message) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = message;
                element.style.display = 'block';
            }
        }

        function validateSection(sectionNumber) {
            const section = document.getElementById('section' + sectionNumber);
            const requiredFields = section.querySelectorAll('[required]');
            let isValid = true;

            requiredFields.forEach(field => {
                if (field.type === 'radio') {
                    const radioGroup = section.querySelectorAll(`input[name="${field.name}"]`);
                    const isChecked = Array.from(radioGroup).some(radio => radio.checked);
                    if (!isChecked) {
                        isValid = false;
                        // Highlight the question group
                        const questionGroup = field.closest('.question-group');
                        if (questionGroup) {
                            questionGroup.style.borderLeft = '4px solid #dc3545';
                            setTimeout(() => {
                                questionGroup.style.borderLeft = '4px solid #4facfe';
                            }, 3000);
                        }
                    }
                } else {
                    if (!validateField(field)) {
                        isValid = false;
                    }
                }
            });

            return isValid;
        }

        function nextSection() {
            if (!validateSection(currentSection)) {
                showAlert('Por favor, preencha todos os campos obrigatórios antes de continuar.', 'danger');
                return;
            }

            // Track section completion time
            const sectionTime = Date.now() - sectionStartTimes[currentSection];
            saveAnalytics('section_time', { section: currentSection, time: sectionTime });

            if (currentSection < totalSections) {
                // Hide current section
                document.getElementById('section' + currentSection).classList.remove('active');
                
                // Show next section
                currentSection++;
                document.getElementById('section' + currentSection).classList.add('active');
                sectionStartTimes[currentSection] = Date.now();
                
                updateProgress();
                updateNavigationButtons();
                
                // Scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });
                
                // Save progress
                saveSessionData();
            }
        }

        function previousSection() {
            if (currentSection > 1) {
                // Hide current section
                document.getElementById('section' + currentSection).classList.remove('active');
                
                // Show previous section
                currentSection--;
                document.getElementById('section' + currentSection).classList.add('active');
                sectionStartTimes[currentSection] = Date.now();
                
                updateProgress();
                updateNavigationButtons();
                
                // Scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function updateProgress() {
            const progress = (currentSection / totalSections) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressText').textContent = Math.round(progress) + '% concluído';
        }

        function updateNavigationButtons() {
            const btnPrevious = document.getElementById('btnPrevious');
            const btnNext = document.getElementById('btnNext');
            const btnSubmit = document.getElementById('btnSubmit');

            btnPrevious.style.display = currentSection > 1 ? 'block' : 'none';
            
            if (currentSection === totalSections) {
                btnNext.style.display = 'none';
                btnSubmit.style.display = 'block';
            } else {
                btnNext.style.display = 'block';
                btnSubmit.style.display = 'none';
            }
        }

        function handleSubmit(e) {
            e.preventDefault();
            
            // Final validation
            let allValid = true;
            for (let i = 1; i <= totalSections; i++) {
                if (!validateSection(i)) {
                    allValid = false;
                    // Go to first invalid section
                    if (currentSection !== i) {
                        currentSection = i;
                        document.querySelectorAll('.section').forEach(section => {
                            section.classList.remove('active');
                        });
                        document.getElementById('section' + i).classList.add('active');
                        updateProgress();
                        updateNavigationButtons();
                    }
                    break;
                }
            }

            if (!allValid) {
                showAlert('Por favor, preencha todos os campos obrigatórios antes de enviar.', 'danger');
                return;
            }

            // Disable submit button
            const btnSubmit = document.getElementById('btnSubmit');
            btnSubmit.disabled = true;
            
            // Show loading
            document.querySelector('.form-container').style.display = 'none';
            document.getElementById('loadingScreen').style.display = 'block';
            
            // Collect and send data
            setTimeout(() => {
                submitForm();
            }, 2000); // Simulate processing time
        }

        function submitForm() {
            try {
                const formData = collectFormData();
                
                // Add CPF to submitted list (simulate database)
                const cpf = formData.responsavel.cpf.replace(/\D/g, '');
                submittedCPFs.push(cpf);
                
                // Send to webhook (replace with actual URL)
                sendToWebhook(formData);
                
                // Clear session data
                clearSessionData();
                
                // Show success
                showSuccess();
                
            } catch (error) {
                console.error('Submission error:', error);
                errors.push(error.message);
                showAlert('Erro ao enviar questionário. Tente novamente.', 'danger');
                
                // Re-enable submit button
                document.getElementById('btnSubmit').disabled = false;
                document.querySelector('.form-container').style.display = 'block';
                document.getElementById('loadingScreen').style.display = 'none';
            }
        }

        function collectFormData() {
            const form = document.getElementById('questionarioForm');
            const formData = new FormData(form);
            
            // Calculate session duration
            const sessionDuration = Math.round((Date.now() - startTime) / 1000);
            
            // Collect device info
            const deviceInfo = getDeviceInfo();
            
            // Structure data according to specification
            const data = {
                metadata: {
                    timestamp: new Date().toISOString(),
                    semestre: "1º Semestre 2025",
                    versao_questionario: "v1.0",
                    submission_id: sessionId,
                    session_duration: sessionDuration,
                    device_type: deviceInfo.type,
                    browser: deviceInfo.browser,
                    screen_resolution: deviceInfo.resolution,
                    ip_address: "xxx.xxx.xxx.xxx", // Would be collected server-side
                    fonte_acesso: "direct_link",
                    abandono_pontos: []
                },
                responsavel: {
                    nome: formData.get('nomeResponsavel'),
                    cpf: formData.get('cpfResponsavel'),
                    telefone: formData.get('telefoneResponsavel')
                },
                aluno: {
                    nome: formData.get('nomeFilho'),
                    turma: formData.get('turma')
                },
                respostas: {
                    pedagogicos: {
                        professores_titulares: formData.get('professores_titulares'),
                        professores_auxiliares: formData.get('professores_auxiliares'),
                        ensino_bilingue: formData.get('ensino_bilingue'),
                        teacher_thalyta: formData.get('teacher_thalyta'),
                        socioemocional: formData.get('socioemocional'),
                        desenvolvimento: formData.get('desenvolvimento'),
                        atividades_ludicas: formData.get('atividades_ludicas'),
                        adaptacao: formData.get('adaptacao'),
                        esportes: formData.get('esportes')
                    },
                    estrutura: {
                        limpeza: formData.get('limpeza'),
                        seguranca: formData.get('seguranca'),
                        salas_aula: formData.get('salas_aula'),
                        playground: formData.get('playground'),
                        banheiros: formData.get('banheiros'),
                        biblioteca: formData.get('biblioteca'),
                        cantina: formData.get('cantina')
                    },
                    comunicacao: {
                        coordenacao: formData.get('coordenacao'),
                        comunicacao: formData.get('comunicacao'),
                        feedbacks: formData.get('feedbacks'),
                        recepcao: formData.get('recepcao'),
                        flexibilidade: formData.get('flexibilidade'),
                        eventos_pedagogicos: formData.get('eventos_pedagogicos'),
                        eventos_recreativos: formData.get('eventos_recreativos')
                    },
                    satisfacao_geral: {
                        recomendaria: formData.get('recomendaria'),
                        satisfacao_geral: formData.get('satisfacao_geral'),
                        crianca_satisfacao: formData.get('crianca_satisfacao')
                    }
                },
                comentarios: {
                    ponto_forte: formData.get('pontoForte') || '',
                    melhorias: formData.get('melhorias') || '',
                    observacoes: formData.get('observacoes') || ''
                },
                analytics: {
                    tempo_por_secao: sectionStartTimes,
                    clicks_totais: clickCount,
                    scroll_depth: scrollDepth + '%',
                    errors_encountered: errors
                }
            };
            
            return data;
        }

        function sendToWebhook(data) {
            // Replace with actual webhook URL
            const webhookUrl = 'https://your-n8n-webhook-url.com/webhook/questionario-amadeus';
            
            fetch(webhookUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(result => {
                console.log('Success:', result);
            })
            .catch(error => {
                console.error('Error:', error);
                // In production, you might want to store data locally and retry later
            });
        }

        function showSuccess() {
            document.getElementById('loadingScreen').style.display = 'none';
            document.getElementById('successScreen').style.display = 'block';
        }

        function showAlert(message, type) {
            const alertElement = document.getElementById('alert' + (type === 'danger' ? 'Error' : 'Success'));
            alertElement.textContent = message;
            alertElement.style.display = 'block';
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                alertElement.style.display = 'none';
            }, 5000);
            
            // Scroll to top to show alert
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function saveSessionData() {
            const formData = new FormData(document.getElementById('questionarioForm'));
            const data = {};
            
            for (let [key, value] of formData.entries()) {
                data[key] = value;
            }
            
            data.currentSection = currentSection;
            data.sessionId = sessionId;
            data.startTime = startTime;
            
            localStorage.setItem('questionario_amadeus_session', JSON.stringify(data));
        }

        function loadSessionData() {
            const savedData = localStorage.getItem('questionario_amadeus_session');
            
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    
                    // Restore form data
                    Object.keys(data).forEach(key => {
                        if (key !== 'currentSection' && key !== 'sessionId' && key !== 'startTime') {
                            const field = document.querySelector(`[name="${key}"]`);
                            if (field) {
                                if (field.type === 'radio') {
                                    const radio = document.querySelector(`[name="${key}"][value="${data[key]}"]`);
                                    if (radio) radio.checked = true;
                                } else {
                                    field.value = data[key];
                                }
                            }
                        }
                    });
                    
                    // Restore session info
                    if (data.sessionId) {
                        sessionId = data.sessionId;
                        document.getElementById('sessionInfo').style.display = 'block';
                    }
                    
                    if (data.startTime) {
                        startTime = data.startTime;
                    }
                    
                } catch (error) {
                    console.error('Error loading session data:', error);
                }
            }
        }

        function clearSessionData() {
            localStorage.removeItem('questionario_amadeus_session');
        }

        function hasUnsavedData() {
            const form = document.getElementById('questionarioForm');
            const inputs = form.querySelectorAll('input, select, textarea');
            
            for (let input of inputs) {
                if (input.value.trim() !== '') {
                    return true;
                }
            }
            return false;
        }

        function getDeviceInfo() {
            const userAgent = navigator.userAgent;
            let deviceType = 'desktop';
            
            if (/tablet|ipad|playbook|silk/i.test(userAgent)) {
                deviceType = 'tablet';
            } else if (/mobile|iphone|ipod|android|blackberry|opera|mini|windows\sce|palm|smartphone|iemobile/i.test(userAgent)) {
                deviceType = 'mobile';
            }
            
            return {
                type: deviceType,
                browser: userAgent,
                resolution: screen.width + 'x' + screen.height
            };
        }

        function generateUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = Math.random() * 16 | 0;
                const v = c == 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        function saveAnalytics(event, data) {
            // Store analytics data for later submission
            const analytics = JSON.parse(localStorage.getItem('questionario_analytics') || '[]');
            analytics.push({
                event: event,
                data: data,
                timestamp: Date.now()
            });
            localStorage.setItem('questionario_analytics', JSON.stringify(analytics));
        }

        function trackPageLoad() {
            saveAnalytics('page_load', {
                timestamp: Date.now(),
                device: getDeviceInfo()
            });
        }

        // Initialize navigation buttons
        updateNavigationButtons();
    </script>
</body>
</html>

